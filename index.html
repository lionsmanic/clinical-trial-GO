<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å©¦ç™Œè‡¨åºŠå°èˆª Ã— AI æ™ºèƒ½åˆ†æ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;900&family=DM+Mono:wght@400;500&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #1a1a2e;
    --ink-soft: #2d2d4a;
    --cream: #f8f5f0;
    --gold: #c9a84c;
    --gold-light: #e8d5a3;
    --teal: #1a6b6b;
    --teal-light: #e8f5f5;
    --rose: #8b2252;
    --rose-light: #fdf0f6;
    --amber: #b85c00;
    --amber-light: #fff4e6;
    --sage: #3a6b3a;
    --sage-light: #edf7ed;
    --border: rgba(201,168,76,0.3);
    --shadow: 0 4px 32px rgba(26,26,46,0.12);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Serif TC', serif;
    background: var(--cream);
    color: var(--ink);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€â”€ HEADER â”€â”€â”€ */
  .site-header {
    background: var(--ink);
    padding: 0;
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 2px solid var(--gold);
  }
  .header-inner {
    max-width: 1400px;
    margin: 0 auto;
    padding: 16px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
  }
  .logo-block { display: flex; align-items: center; gap: 14px; }
  .logo-icon {
    width: 44px; height: 44px;
    background: linear-gradient(135deg, var(--gold), var(--amber));
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
  }
  .logo-text { line-height: 1.1; }
  .logo-title {
    font-family: 'Playfair Display', serif;
    font-size: 18px; font-weight: 900;
    color: var(--gold);
    letter-spacing: 0.02em;
  }
  .logo-sub { font-size: 11px; color: rgba(255,255,255,0.5); font-family: 'DM Mono', monospace; margin-top: 2px; }
  .header-nav { display: flex; gap: 4px; }
  .nav-btn {
    padding: 8px 18px; border-radius: 6px;
    border: 1px solid rgba(255,255,255,0.1);
    background: transparent; color: rgba(255,255,255,0.7);
    font-family: 'Noto Serif TC', serif;
    font-size: 13px; cursor: pointer;
    transition: all 0.2s;
  }
  .nav-btn:hover, .nav-btn.active {
    background: var(--gold); color: var(--ink);
    border-color: var(--gold); font-weight: 600;
  }

  /* â”€â”€â”€ TABS â”€â”€â”€ */
  .main-tabs {
    max-width: 1400px; margin: 0 auto;
    padding: 32px 32px 0;
    display: flex; gap: 0;
    border-bottom: 2px solid var(--border);
  }
  .tab-btn {
    padding: 14px 28px;
    background: transparent;
    border: none; border-bottom: 3px solid transparent;
    font-family: 'Noto Serif TC', serif;
    font-size: 15px; font-weight: 600;
    color: rgba(26,26,46,0.45);
    cursor: pointer; transition: all 0.2s;
    margin-bottom: -2px;
    display: flex; align-items: center; gap: 8px;
  }
  .tab-btn:hover { color: var(--teal); }
  .tab-btn.active {
    color: var(--teal);
    border-bottom-color: var(--teal);
  }
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* â”€â”€â”€ CANCER TYPE SELECTOR â”€â”€â”€ */
  .cancer-selector {
    max-width: 1400px; margin: 0 auto;
    padding: 28px 32px 0;
  }
  .cancer-selector h3 { font-size: 13px; color: rgba(26,26,46,0.45); font-family: 'DM Mono', monospace; margin-bottom: 12px; letter-spacing: 0.08em; text-transform: uppercase; }
  .cancer-btns { display: flex; gap: 10px; flex-wrap: wrap; }
  .cancer-btn {
    padding: 10px 22px; border-radius: 100px;
    border: 1.5px solid var(--border);
    background: white; color: var(--ink-soft);
    font-family: 'Noto Serif TC', serif;
    font-size: 13px; font-weight: 600;
    cursor: pointer; transition: all 0.2s;
    display: flex; align-items: center; gap: 6px;
  }
  .cancer-btn:hover { border-color: var(--teal); color: var(--teal); }
  .cancer-btn.active { background: var(--teal); color: white; border-color: var(--teal); }

  /* â”€â”€â”€ STAGE GRID â”€â”€â”€ */
  .stage-grid {
    max-width: 1400px; margin: 0 auto;
    padding: 24px 32px;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
  }
  .stage-col {
    background: white;
    border-radius: 14px;
    overflow: hidden;
    border: 1.5px solid var(--border);
    box-shadow: var(--shadow);
  }
  .stage-header {
    padding: 16px 18px;
    font-size: 14px; font-weight: 900;
    color: white; text-align: center;
    letter-spacing: 0.03em;
  }
  .stage-p-tx .stage-header { background: linear-gradient(135deg, #1a5c2a, #0f3d1a); }
  .stage-p-mt .stage-header { background: linear-gradient(135deg, #1a3a8b, #0d2460); }
  .stage-r-tx .stage-header { background: linear-gradient(135deg, #8b1a00, #5c1000); }
  .stage-r-mt .stage-header { background: linear-gradient(135deg, #5c1a8b, #3a0d60); }

  .sub-section {
    border-bottom: 1px solid rgba(201,168,76,0.15);
    padding: 12px 14px;
  }
  .sub-section:last-child { border-bottom: none; }
  .sub-title {
    font-size: 11.5px; font-weight: 700;
    color: var(--ink-soft); margin-bottom: 6px;
    display: flex; align-items: center; gap: 5px;
  }
  .sub-content { font-size: 11px; color: rgba(26,26,46,0.6); line-height: 1.5; margin-bottom: 8px; }

  .trial-chip {
    display: block; width: 100%;
    padding: 7px 10px; margin-bottom: 5px;
    border-radius: 7px;
    border: 1px solid var(--border);
    background: var(--cream);
    text-align: left; cursor: pointer;
    font-family: 'DM Mono', monospace;
    font-size: 10px; color: var(--teal);
    font-weight: 500;
    transition: all 0.18s;
    line-height: 1.4;
  }
  .trial-chip:hover {
    background: var(--teal-light);
    border-color: var(--teal);
    transform: translateX(2px);
  }
  .trial-chip.ongoing {
    color: var(--amber); border-color: rgba(184,92,0,0.3);
    background: var(--amber-light);
  }
  .trial-chip.ongoing:hover { background: #ffe8cc; border-color: var(--amber); }

  /* â”€â”€â”€ DETAIL PANEL â”€â”€â”€ */
  .detail-overlay {
    display: none;
    position: fixed; inset: 0;
    background: rgba(26,26,46,0.6);
    z-index: 200;
    backdrop-filter: blur(4px);
    align-items: center; justify-content: center;
  }
  .detail-overlay.open { display: flex; }
  .detail-modal {
    background: white; border-radius: 20px;
    max-width: 820px; width: 92%;
    max-height: 88vh; overflow-y: auto;
    padding: 36px; position: relative;
    border: 2px solid var(--gold-light);
    box-shadow: 0 24px 80px rgba(26,26,46,0.3);
    animation: modalIn 0.25s cubic-bezier(0.34,1.56,0.64,1);
  }
  @keyframes modalIn { from { transform: scale(0.92) translateY(20px); opacity: 0; } to { transform: none; opacity: 1; } }
  .modal-close {
    position: absolute; top: 16px; right: 16px;
    width: 34px; height: 34px; border-radius: 50%;
    border: 1.5px solid var(--border);
    background: white; cursor: pointer; font-size: 18px;
    display: flex; align-items: center; justify-content: center;
    color: var(--ink-soft); transition: all 0.2s;
  }
  .modal-close:hover { background: var(--ink); color: white; border-color: var(--ink); }
  .modal-title { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 900; color: var(--ink); margin-bottom: 6px; padding-right: 40px; }
  .modal-drug { font-family: 'DM Mono', monospace; font-size: 12px; color: var(--teal); background: var(--teal-light); padding: 4px 12px; border-radius: 100px; display: inline-block; margin-bottom: 20px; }
  .modal-section { margin-bottom: 20px; }
  .modal-section-title {
    font-size: 11px; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase;
    color: rgba(26,26,46,0.4); margin-bottom: 10px; font-family: 'DM Mono', monospace;
    padding-bottom: 6px; border-bottom: 1px solid var(--border);
  }
  .result-highlight {
    background: linear-gradient(135deg, #fff9ee, #fff4dd);
    border-left: 4px solid var(--gold);
    padding: 14px 16px; border-radius: 8px;
    font-size: 13.5px; line-height: 1.65;
  }
  .regimen-box {
    background: var(--sage-light);
    border-left: 4px solid var(--sage);
    padding: 14px 16px; border-radius: 8px;
    font-size: 12.5px; line-height: 1.7;
    font-family: 'DM Mono', monospace;
  }
  .criteria-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .criteria-box { padding: 14px; border-radius: 10px; }
  .criteria-box.inc { background: var(--sage-light); border: 1px solid rgba(58,107,58,0.2); }
  .criteria-box.exc { background: var(--rose-light); border: 1px solid rgba(139,34,82,0.2); }
  .criteria-box h5 { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; font-family: 'DM Mono', monospace; }
  .criteria-box.inc h5 { color: var(--sage); }
  .criteria-box.exc h5 { color: var(--rose); }
  .criteria-box li { font-size: 12px; line-height: 1.6; margin-left: 14px; margin-bottom: 4px; }

  /* â”€â”€â”€ AI ANALYSIS TAB â”€â”€â”€ */
  .ai-panel {
    max-width: 1000px; margin: 0 auto;
    padding: 40px 32px;
  }
  .ai-hero { text-align: center; margin-bottom: 40px; }
  .ai-hero h2 { font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 900; color: var(--ink); margin-bottom: 8px; }
  .ai-hero p { font-size: 14px; color: rgba(26,26,46,0.55); line-height: 1.7; max-width: 600px; margin: 0 auto; }
  .ai-hero .badge { display: inline-block; margin-top: 12px; padding: 5px 16px; background: var(--teal-light); border: 1px solid rgba(26,107,107,0.3); border-radius: 100px; font-size: 11px; font-family: 'DM Mono', monospace; color: var(--teal); }

  .api-setup {
    background: var(--ink);
    border-radius: 14px; padding: 20px 24px;
    margin-bottom: 28px;
    display: flex; align-items: center; gap: 16px;
  }
  .api-setup-text { flex: 1; }
  .api-setup-text h4 { color: var(--gold); font-size: 13px; margin-bottom: 4px; }
  .api-setup-text p { color: rgba(255,255,255,0.5); font-size: 11px; font-family: 'DM Mono', monospace; }
  .api-input {
    flex: 2; padding: 10px 16px;
    border-radius: 8px; border: 1.5px solid rgba(201,168,76,0.4);
    background: rgba(255,255,255,0.06);
    color: white; font-family: 'DM Mono', monospace;
    font-size: 12px;
  }
  .api-input::placeholder { color: rgba(255,255,255,0.3); }

  .input-mode-tabs { display: flex; gap: 8px; margin-bottom: 20px; }
  .mode-tab {
    padding: 9px 20px; border-radius: 8px;
    border: 1.5px solid var(--border);
    background: white; color: rgba(26,26,46,0.5);
    font-size: 13px; font-weight: 600; cursor: pointer;
    transition: all 0.2s; display: flex; align-items: center; gap: 7px;
  }
  .mode-tab:hover { border-color: var(--teal); color: var(--teal); }
  .mode-tab.active { background: var(--teal); color: white; border-color: var(--teal); }

  .input-area {
    background: white; border-radius: 14px;
    border: 1.5px solid var(--border);
    padding: 24px;
    box-shadow: var(--shadow);
    margin-bottom: 20px;
  }
  .text-input {
    width: 100%; min-height: 180px;
    border: 1.5px solid rgba(201,168,76,0.25);
    border-radius: 10px; padding: 16px;
    font-family: 'Noto Serif TC', serif;
    font-size: 13.5px; line-height: 1.8;
    color: var(--ink); resize: vertical;
    background: var(--cream);
    transition: border-color 0.2s;
  }
  .text-input:focus { outline: none; border-color: var(--teal); background: white; }
  .text-input::placeholder { color: rgba(26,26,46,0.35); }

  .upload-zone {
    border: 2px dashed rgba(201,168,76,0.4);
    border-radius: 12px; padding: 40px;
    text-align: center; cursor: pointer;
    transition: all 0.2s; background: var(--cream);
  }
  .upload-zone:hover { border-color: var(--teal); background: var(--teal-light); }
  .upload-zone .icon { font-size: 36px; margin-bottom: 12px; }
  .upload-zone h4 { font-size: 14px; color: var(--ink-soft); margin-bottom: 6px; }
  .upload-zone p { font-size: 12px; color: rgba(26,26,46,0.45); font-family: 'DM Mono', monospace; }
  .upload-zone input { display: none; }
  .uploaded-preview {
    display: none;
    align-items: center; gap: 12px;
    background: var(--sage-light); padding: 12px 16px;
    border-radius: 10px; margin-top: 12px;
  }
  .uploaded-preview.show { display: flex; }
  .uploaded-preview img { max-height: 80px; border-radius: 6px; }
  .uploaded-preview span { font-size: 12px; color: var(--sage); font-family: 'DM Mono', monospace; }

  .structured-form { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .form-group { display: flex; flex-direction: column; gap: 6px; }
  .form-group label { font-size: 11px; font-weight: 700; color: rgba(26,26,46,0.5); text-transform: uppercase; letter-spacing: 0.08em; font-family: 'DM Mono', monospace; }
  .form-select, .form-input-small {
    padding: 9px 12px; border-radius: 8px;
    border: 1.5px solid var(--border);
    background: var(--cream); color: var(--ink);
    font-family: 'Noto Serif TC', serif; font-size: 13px;
  }
  .form-select:focus, .form-input-small:focus { outline: none; border-color: var(--teal); background: white; }

  .analyze-btn {
    width: 100%; padding: 16px;
    background: linear-gradient(135deg, var(--teal), #0d4848);
    color: white; border: none; border-radius: 12px;
    font-family: 'Noto Serif TC', serif; font-size: 16px; font-weight: 700;
    cursor: pointer; transition: all 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 10px;
    box-shadow: 0 4px 20px rgba(26,107,107,0.35);
    letter-spacing: 0.02em;
  }
  .analyze-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 28px rgba(26,107,107,0.45); }
  .analyze-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  .analyze-btn .spinner { width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€â”€ AI RESULT â”€â”€â”€ */
  .ai-result {
    display: none;
    background: white; border-radius: 16px;
    border: 1.5px solid var(--gold-light);
    padding: 32px; margin-top: 24px;
    box-shadow: var(--shadow);
    animation: fadeUp 0.4s ease;
  }
  .ai-result.show { display: block; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: none; } }
  .result-header { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; }
  .result-header .gemini-badge { padding: 5px 14px; background: linear-gradient(135deg, #4285f4, #0d47a1); color: white; border-radius: 100px; font-size: 10px; font-family: 'DM Mono', monospace; }
  .result-header h3 { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--ink); }
  .result-content { font-size: 14px; line-height: 1.85; color: var(--ink-soft); }
  .result-content h4 { color: var(--teal); font-size: 15px; margin: 18px 0 8px; padding-left: 12px; border-left: 3px solid var(--teal); }
  .result-content ul { padding-left: 20px; margin: 8px 0; }
  .result-content li { margin-bottom: 6px; }
  .result-content strong { color: var(--ink); }
  .trial-match-chip {
    display: inline-block; margin: 4px;
    padding: 6px 14px; border-radius: 8px;
    background: var(--teal-light); color: var(--teal);
    font-size: 11px; font-family: 'DM Mono', monospace; font-weight: 600;
    border: 1px solid rgba(26,107,107,0.2);
  }
  .trial-match-chip.ongoing-match {
    background: var(--amber-light); color: var(--amber);
    border-color: rgba(184,92,0,0.2);
  }

  /* â”€â”€â”€ ERROR / INFO â”€â”€â”€ */
  .info-box { padding: 14px 18px; border-radius: 10px; font-size: 13px; margin-bottom: 16px; }
  .info-box.warn { background: var(--amber-light); border: 1px solid rgba(184,92,0,0.25); color: var(--amber); }
  .info-box.tip { background: var(--teal-light); border: 1px solid rgba(26,107,107,0.2); color: var(--teal); }

  /* â”€â”€â”€ FOOTER â”€â”€â”€ */
  .site-footer {
    text-align: center; padding: 32px;
    border-top: 1px solid var(--border);
    color: rgba(26,26,46,0.35);
    font-size: 11px; font-family: 'DM Mono', monospace;
    line-height: 1.8;
  }
  @media (max-width: 900px) {
    .stage-grid { grid-template-columns: 1fr 1fr; }
    .criteria-grid { grid-template-columns: 1fr; }
    .structured-form { grid-template-columns: 1fr; }
    .header-inner { flex-direction: column; align-items: flex-start; gap: 10px; }
    .header-nav { flex-wrap: wrap; }
    .api-setup { flex-direction: column; }
  }
  @media (max-width: 600px) {
    .stage-grid { grid-template-columns: 1fr; }
    .main-tabs { padding: 24px 16px 0; }
    .cancer-selector, .stage-grid, .ai-panel { padding-left: 16px; padding-right: 16px; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<header class="site-header">
  <div class="header-inner">
    <div class="logo-block">
      <div class="logo-icon">ğŸ©º</div>
      <div class="logo-text">
        <div class="logo-title">å©¦ç™Œè‡¨åºŠå°èˆªç³»çµ±</div>
        <div class="logo-sub">Gynecologic Oncology Navigator Â· 2026</div>
      </div>
    </div>
    <nav class="header-nav">
      <button class="nav-btn active" onclick="switchTab('nav')">ğŸ—º è©¦é©—å°èˆªåœ°åœ–</button>
      <button class="nav-btn" onclick="switchTab('ai')">ğŸ¤– AI æ‚£è€…åˆ†æ</button>
    </nav>
  </div>
</header>

<!-- NAVIGATION TAB -->
<div id="tab-nav" class="tab-panel active">
  <div class="cancer-selector">
    <h3>é¸æ“‡ç™Œç—‡é¡å‹</h3>
    <div class="cancer-btns">
      <button class="cancer-btn active" onclick="selectCancer('Endometrial', this)">ğŸ”´ å­å®®å…§è†œç™Œ</button>
      <button class="cancer-btn" onclick="selectCancer('Ovarian', this)">ğŸŸ£ åµå·¢ç™Œ</button>
      <button class="cancer-btn" onclick="selectCancer('Cervical', this)">ğŸŸ  å­å®®é ¸ç™Œ</button>
      <button class="cancer-btn" onclick="selectCancer('Uterine Sarcoma', this)">ğŸ”µ å­å®®è‚‰ç˜¤</button>
    </div>
  </div>
  <div id="stage-grid" class="stage-grid"></div>
</div>

<!-- AI TAB -->
<div id="tab-ai" class="tab-panel">
  <div class="ai-panel">
    <div class="ai-hero">
      <h2>AI æ‚£è€…è‡¨åºŠè·¯å¾‘åˆ†æ</h2>
      <p>è²¼ä¸Šæ‚£è€…ç—…æ­·æ‘˜è¦ï¼Œæˆ–ä¸Šå‚³ç—…ç†/å½±åƒç…§ç‰‡ï¼ŒGemini AI å°‡æ ¹æ“šå©¦ç™Œè©¦é©—è³‡æ–™åº«ï¼Œæ¨è–¦æœ€é©åˆçš„æ²»ç™‚è·¯å¾‘èˆ‡å¯åƒèˆ‡çš„è‡¨åºŠè©¦é©—ã€‚</p>
      <span class="badge">âš¡ Powered by Google Gemini Â· éœ€è¼¸å…¥ API Key</span>
    </div>

    <div class="api-setup">
      <div class="api-setup-text">
        <h4>ğŸ”‘ Gemini API Key</h4>
        <p>å‰å¾€ aistudio.google.com å…è²»å–å¾—</p>
      </div>
      <input type="password" class="api-input" id="apiKey" placeholder="AIzaSy...">
    </div>

    <div class="info-box tip">
      ğŸ’¡ æ‚£è€…è³‡æ–™åƒ…åœ¨æ‚¨çš„ç€è¦½å™¨ä¸­è™•ç†ï¼Œä¸æœƒå„²å­˜æ–¼ä»»ä½•ä¼ºæœå™¨ã€‚API è«‹æ±‚ç›´æ¥ç”±æ‚¨çš„ç€è¦½å™¨ç™¼é€è‡³ Googleã€‚
    </div>

    <div class="input-area">
      <div class="input-mode-tabs">
        <button class="mode-tab active" onclick="switchMode('text', this)">ğŸ“ æ–‡å­—è¼¸å…¥</button>
        <button class="mode-tab" onclick="switchMode('image', this)">ğŸ–¼ å½±åƒä¸Šå‚³</button>
        <button class="mode-tab" onclick="switchMode('form', this)">ğŸ“‹ çµæ§‹åŒ–è¡¨å–®</button>
      </div>

      <!-- TEXT MODE -->
      <div id="mode-text">
        <textarea class="text-input" id="textInput" placeholder="è«‹è²¼ä¸Šæ‚£è€…ç—…æ­·æ‘˜è¦ï¼Œä¾‹å¦‚ï¼š

æ‚£è€…å¥³æ€§ï¼Œ63æ­²ï¼Œå­å®®å…§è†œç™Œ Stage IIIC2ã€‚
çµ„ç¹”å‹æ…‹ï¼šå­å®®å…§è†œæ¨£è…ºç™Œï¼ŒGrade 3ã€‚
åˆ†å­åˆ†å‹ï¼šdMMRï¼ˆMLH1/PMS2 ç¼ºå¤±ï¼‰ï¼Œp53 wild-typeï¼ŒPOLE æœªçªè®Šã€‚
CA-125: 68 U/mLã€‚
æ—¢å¾€æ²»ç™‚ï¼šå·²å®Œæˆå»£æ³›æ€§å­å®®åˆ‡é™¤è¡“ + é›™å´é™„ä»¶åˆ‡é™¤ + éª¨ç›†æ·‹å·´æ¸…æƒã€‚
ç›®å‰è€ƒæ…®ä¸€ç·šåŒ–ç™‚æ–¹æ¡ˆï¼Œè©¢å•æ˜¯å¦å¯åŠ å…¥å…ç–«æ²»ç™‚æˆ–è‡¨åºŠè©¦é©—ã€‚"></textarea>
      </div>

      <!-- IMAGE MODE -->
      <div id="mode-image" style="display:none">
        <div class="upload-zone" onclick="document.getElementById('imgUpload').click()" id="uploadZone">
          <div class="icon">ğŸ“·</div>
          <h4>é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ç—…ç†/å½±åƒæª”æ¡ˆ</h4>
          <p>æ”¯æ´ JPG Â· PNG Â· WEBP Â· ç—…ç†åˆ‡ç‰‡ Â· CT æˆªåœ– Â· å ±å‘Šæƒæ</p>
          <input type="file" id="imgUpload" accept="image/*" onchange="handleImageUpload(event)">
        </div>
        <div class="uploaded-preview" id="uploadedPreview">
          <img id="previewImg" src="" alt="preview">
          <span id="previewName"></span>
        </div>
        <textarea class="text-input" id="imageContextInput" style="margin-top:14px; min-height:80px;" placeholder="è£œå……èªªæ˜ï¼ˆé¸å¡«ï¼‰ï¼šä¾‹å¦‚æ‚£è€…å¹´é½¡ã€è‡¨åºŠåˆ†æœŸã€å…¶ä»–æ¨™è¨˜ç­‰â€¦"></textarea>
      </div>

      <!-- FORM MODE -->
      <div id="mode-form" style="display:none">
        <div class="structured-form">
          <div class="form-group">
            <label>ç™Œç—‡é¡å‹</label>
            <select class="form-select" id="f-cancer">
              <option>å­å®®å…§è†œç™Œ (Endometrial)</option>
              <option>åµå·¢ç™Œ (Ovarian)</option>
              <option>å­å®®é ¸ç™Œ (Cervical)</option>
              <option>å­å®®è‚‰ç˜¤ (Uterine Sarcoma)</option>
            </select>
          </div>
          <div class="form-group">
            <label>FIGO åˆ†æœŸ</label>
            <select class="form-select" id="f-stage">
              <option>Stage I</option><option>Stage II</option>
              <option>Stage III</option><option>Stage IV</option><option>å¾©ç™¼</option>
            </select>
          </div>
          <div class="form-group">
            <label>MMR ç‹€æ…‹</label>
            <select class="form-select" id="f-mmr">
              <option>dMMR / MSI-H</option><option>pMMR / MSS</option><option>æœªæª¢æ¸¬</option>
            </select>
          </div>
          <div class="form-group">
            <label>p53 ç‹€æ…‹</label>
            <select class="form-select" id="f-p53">
              <option>wild-type</option><option>mutant (abn)</option><option>æœªæª¢æ¸¬</option>
            </select>
          </div>
          <div class="form-group">
            <label>BRCA / HRDï¼ˆåµå·¢ç™Œï¼‰</label>
            <select class="form-select" id="f-brca">
              <option>BRCA1/2 çªè®Š</option><option>HRD é™½æ€§ï¼ˆBRCA wtï¼‰</option>
              <option>HRD é™°æ€§</option><option>æœªæª¢æ¸¬</option>
            </select>
          </div>
          <div class="form-group">
            <label>ECOG é«”èƒ½ç‹€æ…‹</label>
            <select class="form-select" id="f-ecog">
              <option>ECOG 0</option><option>ECOG 1</option>
              <option>ECOG 2</option><option>ECOG â‰¥3</option>
            </select>
          </div>
          <div class="form-group" style="grid-column:1/-1">
            <label>æ—¢å¾€æ²»ç™‚å²</label>
            <input type="text" class="form-input-small" id="f-prior" placeholder="ä¾‹å¦‚ï¼šå»£æ³›å­å®®åˆ‡é™¤ + éª¨ç›†æ·‹å·´æ¸…æƒï¼Œæœªæ›¾æ¥å—ç³»çµ±åŒ–ç™‚">
          </div>
          <div class="form-group" style="grid-column:1/-1">
            <label>å…¶ä»–é‡è¦æ¨™è¨˜</label>
            <input type="text" class="form-input-small" id="f-markers" placeholder="ä¾‹å¦‚ï¼šHER2 2+, FRÎ± é«˜è¡¨ç¾, POLE mutation, PD-L1 CPSâ€¦">
          </div>
        </div>
      </div>
    </div>

    <button class="analyze-btn" id="analyzeBtn" onclick="runAnalysis()">
      <span id="btnIcon">âœ¨</span>
      <span id="btnText">å•Ÿå‹• Gemini AI åˆ†æ</span>
    </button>

    <div id="aiResult" class="ai-result">
      <div class="result-header">
        <span class="gemini-badge">GEMINI AI</span>
        <h3>è‡¨åºŠè·¯å¾‘åˆ†æå ±å‘Š</h3>
      </div>
      <div class="result-content" id="resultContent"></div>
    </div>
  </div>
</div>

<!-- DETAIL MODAL -->
<div class="detail-overlay" id="detailOverlay" onclick="closeModal(event)">
  <div class="detail-modal">
    <button class="modal-close" onclick="closeModal(null, true)">âœ•</button>
    <div class="modal-title" id="modalTitle"></div>
    <div class="modal-drug" id="modalDrug"></div>
    <div class="modal-section">
      <div class="modal-section-title">æ ¸å¿ƒçµè«– Key Results</div>
      <div class="result-highlight" id="modalResults"></div>
    </div>
    <div class="modal-section">
      <div class="modal-section-title">ç§‘å­¸ç†æ“š Scientific Rationale</div>
      <div id="modalRationale" style="font-size:13.5px; line-height:1.75; color:var(--ink-soft);"></div>
    </div>
    <div class="modal-section">
      <div class="modal-section-title">çµ¦è—¥æ–¹æ¡ˆ Regimen per Arm</div>
      <div class="regimen-box" id="modalRegimen"></div>
    </div>
    <div class="modal-section">
      <div class="modal-section-title">ç´å…¥ / æ’é™¤æ¨™æº–</div>
      <div class="criteria-grid">
        <div class="criteria-box inc">
          <h5>âœ… Inclusion</h5>
          <ul id="modalInclusion"></ul>
        </div>
        <div class="criteria-box exc">
          <h5>âŒ Exclusion</h5>
          <ul id="modalExclusion"></ul>
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="site-footer">
  å©¦ç™Œè‡¨åºŠå°èˆªç³»çµ± Â· 2026 æ——è‰¦æ•´åˆç‰ˆ Â· åƒ…ä¾›é†«ç™‚å°ˆæ¥­äººå“¡åƒè€ƒä½¿ç”¨<br>
  All clinical data sourced from published trial results and ClinicalTrials.gov Â· Not for patient self-diagnosis
</footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA: è‡¨åºŠè©¦é©—è³‡æ–™åº« (ç²¾é¸æ ¸å¿ƒ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TRIALS_DB = [
  // Endometrial
  {cancer:"Endometrial",pos:["P-TX","R-TX"],sub:["dMMR / MSI-H / MMRd","Recurrent EC"],name:"RUBY (ENGOT-EN6)",pharma:"GSK",drug:"Dostarlimab + CP",type:"published",
   pop:"dMMR PFS HR 0.28ï¼›å…¨é«” OS HR 0.64ã€‚å¥ å®šä¸€ç·šå…ç–«+åŒ–ç™‚æ–°æ¨™æº–ã€‚",
   rationale:"PD-1é˜»æ–·èˆ‡å«é‰‘åŒ–ç™‚å…·å”åŒICDæ•ˆæ‡‰ï¼Œè—‰ç”±åŒ–ç™‚èª˜å°è…«ç˜¤æŠ—åŸé‡‹æ”¾ï¼Œå°MMRdæ—ç¾¤é”æˆæ¥µé«˜æŒä¹…æ‡‰ç­”ç‡ã€‚",
   regimen:"èª˜å°æœŸ: Dostarlimab 500mg Q3W + Carboplatin AUC5 + Paclitaxel 175mg/mÂ² x6é€±æœŸ\nç¶­æŒæœŸ: Dostarlimab 1000mg Q6W æŒçºŒ3å¹´",
   inclusion:["Stage III-IVæˆ–é¦–æ¬¡å¾©ç™¼EC","ECOG 0-1","å«Carcinosarcoma/Clear cell/Serous"],
   exclusion:["æ—¢å¾€PD-1/PD-L1æ²»ç™‚","æ´»å‹•æ€§è‡ªé«”å…ç–«ç–¾ç—…","è‡¨åºŠé¡¯è‘—CNSè½‰ç§»"],
   outcomes:"dMMR 24m PFSç‡: 61.4% vs 15.7% (HR 0.28); ITT OS HR 0.64 (P=0.0021)"},
  {cancer:"Endometrial",pos:["P-TX","R-TX"],sub:["dMMR / MSI-H / MMRd","pMMR / NSMP / MSS","Recurrent EC"],name:"NRG-GY018 (KEYNOTE-868)",pharma:"MSD",drug:"Pembrolizumab + CP",type:"published",
   pop:"dMMR PFS HR 0.30ï¼›pMMR PFS HR 0.54ã€‚ä¸€ç·šå…ç–«+åŒ–ç™‚é—œéµè©¦é©—ã€‚",
   rationale:"ICIé‡å¡‘è…«ç˜¤å¾®ç’°å¢ƒï¼ŒPembrolizumabå¼·åŒ–ä¸€ç·šå«é‰‘åŒ–ç™‚åæ‡‰å¾Œçš„æŒä¹…æ€§ã€‚",
   regimen:"Arm A: Pembrolizumab 200mg Q3W + CP x6é€±æœŸ\nç¶­æŒæœŸ: Pembrolizumab 400mg Q6W x2å¹´",
   inclusion:["Stage III/IVæˆ–å¾©ç™¼EC","æä¾›MMR IHCæª¢æ¸¬","ECOG 0-1"],
   exclusion:["æ—¢å¾€anti-PD-(L)1","æ´»å‹•æ€§è‡ªé«”å…ç–«éœ€æ²»ç™‚","CNSæ´»å‹•æ€§ç—…ç¶"],
   outcomes:"dMMR PFS HR 0.30 (95% CI 0.19-0.48); pMMR PFS HR 0.54 (P<0.001)"},
  {cancer:"Endometrial",pos:["P-TX"],sub:["pMMR / NSMP / MSS"],name:"DUO-E (ENGOT-EN9)",pharma:"AZ",drug:"Durvalumab + CP â†’ Durva Â± Ola",type:"published",
   pop:"Durva+åŒ–ç™‚ PFS HR 0.71ï¼›ä¸‰è—¥çµ„ PFS HR 0.55ï¼›pMMRä¸‰è—¥çµ„ HR 0.57ã€‚",
   rationale:"PARPièˆ‡PD-L1æŠ‘åˆ¶åŠ‘åœ¨ç¶­æŒéšæ®µçš„å”åŒæ•ˆæœï¼ŒPARPièª˜å°DNAæå‚·å¢åŠ æ–°æŠ—åŸè² è·ã€‚",
   regimen:"Arm 1: CPå°ç…§çµ„\nArm 2: CP+Durvalumab â†’ Durva 1500mg Q4Wç¶­æŒ\nArm 3: CP+Durvalumab â†’ Durva + Olaparib 300mg bidç¶­æŒ",
   inclusion:["æ™šæœŸæˆ–å¾©ç™¼ECä¸€ç·š","é©åˆCP","ECOG 0-1"],
   exclusion:["æ—¢å¾€å…ç–«æ²»ç™‚/PARPi","æ´»å‹•æ€§è‡ªé«”å…ç–«ç–¾ç—…"],
   outcomes:"pMMR Arm3 vs Arm1: PFS HR 0.57 (95% CI 0.42-0.79)"},
  {cancer:"Endometrial",pos:["P-MT"],sub:["Maintenance Therapy"],name:"MK2870-033 (Ongoing)",pharma:"MSD",drug:"Sac-TMT + Pembrolizumab",type:"ongoing",
   pop:"ä¸€ç·špMMRç¶­æŒï¼šTROP2-ADC+PD-1è¯åˆç¶­æŒï¼Œè£œè¶³pMMRå…ç–«å–®è—¥åæ‡‰ä¸è¶³çš„ç¼ºå£ã€‚",
   rationale:"æ¨™é¶Trop-2 ADCå”åŒPD-1ã€‚ADCèª˜å°ICDæ”¹å–„å¾®ç’°å¢ƒï¼Œæå‡pMMRæ‚£è€…ç¶­æŒéšæ®µæ‡‰ç­”æ·±åº¦ã€‚",
   regimen:"Arm A: Sac-TMT 5mg/kg Q6W + Pembrolizumab 400mg Q6Wç¶­æŒ\nArm B: é†«å¸«é¸æ“‡ç¶­æŒæ–¹æ¡ˆï¼ˆå°ç…§ï¼‰",
   inclusion:["æ–°è¨ºæ–·pMMR/MSS EC","FIGO III-IVæœŸ","ä¸€ç·šCP+Pembroå¾ŒCR/PR"],
   exclusion:["å…ˆå‰ç³»çµ±æ€§IOæ²»ç™‚","å­å®®è‚‰ç˜¤"],
   outcomes:"æ‹›å‹Ÿä¸­ (Ongoing)"},
  {cancer:"Endometrial",pos:["R-TX"],sub:["Recurrent EC"],name:"KEYNOTE-775 (KN775)",pharma:"MSD/Eisai",drug:"Lenvatinib + Pembrolizumab",type:"published",
   pop:"å¾©ç™¼ECäºŒç·šï¼špMMR OS HR 0.68ï¼›å…¨é«” OS HR 0.62ã€‚ç¢ºç«‹äºŒç·šé‡è¦çµ„åˆã€‚",
   rationale:"VEGF-TKIé‡å¡‘è¡€ç®¡ä¸¦æ¸›è¼•å…ç–«æŠ‘åˆ¶ï¼Œå…‹æœMSSè…«ç˜¤ä¹‹å…ç–«å†·å¾®ç’°å¢ƒã€‚",
   regimen:"Lenvatinib 20mg QD + Pembrolizumab 200mg Q3W ç›´è‡³é€²å±•",
   inclusion:["å…ˆå‰è‡³å°‘ä¸€æ¬¡å«é‰‘åŒ–ç™‚é€²å±•","ECOG 0-1","ä¸é™MMRç‹€æ…‹"],
   exclusion:["æ—¢å¾€PD-1/PD-L1","æœªæ§åˆ¶é«˜è¡€å£“","å‡ºè¡€/å»”ç®¡é«˜é¢¨éšª"],
   outcomes:"pMMR OS: 17.4m vs 12.0m (HR 0.68); ITT OS HR 0.62"},
  // Ovarian
  {cancer:"Ovarian",pos:["P-MT"],sub:["BRCA mutation"],name:"SOLO-1",pharma:"AZ",drug:"Olaparib",type:"published",
   pop:"BRCAmä¸€ç·šç¶­æŒé‡‘æ¨™æº–ï¼š7å¹´å­˜æ´»ç‡67%ï¼ŒPFS HR 0.33ã€‚",
   rationale:"é‡å°BRCAçªè®Šæ‚£è€…ï¼ŒPARPié”æˆåˆæˆè‡´æ­»æ•ˆæœå»¶ç·©å¾©ç™¼ã€‚",
   regimen:"Olaparib 300mg BID ç¶­æŒï¼ˆé€šå¸¸è‡³2å¹´æˆ–é€²å±•ï¼‰\nå°ç…§çµ„: Placebo",
   inclusion:["æ–°è¨ºæ–·æ™šæœŸåµå·¢ç™Œ","germlineæˆ–somatic BRCA1/2çªè®Š","ä¸€ç·šé‰‘åŒ–ç™‚å¾ŒCR/PR"],
   exclusion:["å…ˆå‰æ¥å—PARPæŠ‘åˆ¶åŠ‘","æŒçºŒæ€§éª¨é«“æŠ‘åˆ¶"],
   outcomes:"mPFS: 56.0m vs 13.8m (HR 0.30); 7yr OS Rate 67%"},
  {cancer:"Ovarian",pos:["P-MT"],sub:["HRD positive (wt)","HRD negative (pHRD)"],name:"PRIMA",pharma:"GSK",drug:"Niraparib",type:"published",
   pop:"å…¨äººç¾¤ä¸€ç·šç¶­æŒï¼šHRD+ PFS HR 0.43ï¼›å…¨é«”ITT HR 0.62ã€‚",
   rationale:"ä¸è«–HRDç‹€æ…‹ï¼ŒPARPiå¼·åŒ–ä¸€ç·šåŒ–ç™‚å¾Œç¶­æŒç²ç›Šã€‚",
   regimen:"Niraparib ç¶­æŒï¼ˆèµ·å§‹åŠ‘é‡ä¾é«”é‡/è¡€å°æ¿èª¿æ•´ï¼Œè‡³36å€‹æœˆæˆ–é€²å±•ï¼‰",
   inclusion:["æ–°è¨ºæ–·Stage III/IVé«˜å¾©ç™¼é¢¨éšª","ä¸€ç·šé‰‘åŒ–ç™‚å¾ŒCR/PR"],
   exclusion:["MDS/AMLé¢¨éšª","å…ˆå‰PARPæŠ‘åˆ¶åŠ‘"],
   outcomes:"HRD+ PFS HR 0.43 (95% CI 0.31-0.59); ITT HR 0.62"},
  {cancer:"Ovarian",pos:["R-TX"],sub:["PROC (Resistant Recur)"],name:"MIRASOL (GOG-3045)",pharma:"ImmunoGen",drug:"Mirvetuximab Soravtansine",type:"published",
   pop:"FRÎ±é«˜è¡¨ç¾PROCï¼šOS HR 0.67ï¼›ORR 42.3%ã€‚ç¢ºç«‹FRÎ± ADCé—œéµåœ°ä½ã€‚",
   rationale:"é‡å°FRÎ±é«˜è¡¨ç¾PROCæ‚£è€…ï¼Œé¦–å€‹ADCç”Ÿå­˜ç²ç›Šç ”ç©¶ã€‚",
   regimen:"Mirvetuximab 6.0mg/kg (AIBW) IV Q3W ç›´è‡³é€²å±•\nå°ç…§: é†«å¸«é¸æ“‡åŒ–ç™‚",
   inclusion:["é‰‘é¡æŠ—è—¥","FRÎ±é«˜è¡¨ç¾"],
   exclusion:["ä¸ç¬¦åˆFRÎ±é–€æª»","ä¸å¯æ§çœ¼éƒ¨/ç¥ç¶“æ¯’æ€§é¢¨éšª"],
   outcomes:"mOS: 16.4m vs 12.7m (HR 0.67); mPFS HR 0.65; ORR 42.3%"},
  {cancer:"Ovarian",pos:["R-TX"],sub:["PSOC (Sensitive Recur)"],name:"DESKTOP III",pharma:"AGO",drug:"Secondary Cytoreduction Surgery",type:"published",
   pop:"AGO Score+æ‚£è€…æ¬¡æ¸›ç©æ‰‹è¡“ï¼šOS HR 0.75ã€‚R0åˆ‡é™¤mOS 53.7mã€‚",
   rationale:"åš´é¸æ‚£è€…ï¼ˆAGO Scoreé™½æ€§ï¼‰äºŒæ¬¡æ‰‹è¡“å…·ç”Ÿå­˜ç²ç›Šã€‚",
   regimen:"æ‰‹è¡“çµ„: è…«ç˜¤å®Œå…¨åˆ‡é™¤ â†’ å«é‰‘åŒ–ç™‚\nåŒ–ç™‚çµ„: å–®ç´”å«é‰‘è¤‡æ–¹åŒ–ç™‚",
   inclusion:["é¦–æ¬¡é‰‘é¡æ•æ„Ÿå¾©ç™¼ PFI>6m","AGO Scoreé™½æ€§","å¯æœ›é”åˆ°complete resection"],
   exclusion:["ç„¡æ³•é”åˆ°R0æˆ–æ‰‹è¡“é¢¨éšªéé«˜"],
   outcomes:"ITT mOS: 53.7m vs 46.0m (HR 0.75); R0åˆ‡é™¤mOS 61.9m"},
  // Cervical
  {cancer:"Cervical",pos:["P-TX"],sub:["Locally Advanced (CCRT)"],name:"KEYNOTE-A18 (ENGOT-cx11)",pharma:"MSD",drug:"Pembrolizumab + CCRT",type:"published",
   pop:"LACCæ¨™æº–ï¼š36m OS 82.6% (HR 0.67)ã€‚å…ç–«æ²»ç™‚æ•´åˆå…¥æ ¹æ²»åŒæ­¥åŒ–æ”¾ç™‚ã€‚",
   rationale:"å°‡å…ç–«æ•´åˆå…¥é«˜é¢¨éšªå±€éƒ¨æ™šæœŸä¹‹æ ¹æ²»åŒæ­¥åŒ–æ”¾ç™‚ã€‚",
   regimen:"CCRT (Cisplatin 40mg/mÂ² é€±æœ + RT) åŒæ­¥ Pembro 200mg Q3W x5é€±æœŸ\nâ†’ ç¶­æŒ Pembro 400mg Q6W x15é€±æœŸ",
   inclusion:["æ–°è¨ºæ–·Stage IB2-IIB LN(+)æˆ–Stage III-IVA"],
   exclusion:["æ—¢å¾€ç³»çµ±æ€§æ²»ç™‚","æ´»å‹•æ€§è‡ªé«”å…ç–«","æ”¾ç™‚ç¦å¿Œ"],
   outcomes:"24m PFS: 68% vs 57% (HR 0.70); 36m OS: 82.6% vs 74.8% (HR 0.67)"},
  {cancer:"Cervical",pos:["P-TX"],sub:["Locally Advanced (CCRT)"],name:"INTERLACE",pharma:"UCL",drug:"Induction Carbo/Pacli â†’ CCRT",type:"published",
   pop:"èª˜å°åŒ–ç™‚â†’CCRTç­–ç•¥ï¼š5å¹´OS 80% vs 72% (HR 0.60)ã€‚",
   rationale:"èª˜å°åŒ–ç™‚è§£æ±ºæ”¾ç™‚å‰çš„å¾®å°è½‰ç§»ã€‚",
   regimen:"èª˜å°æœŸ: Paclitaxel 80mg/mÂ² + Carboplatin AUC2 æ¯é€± x6é€±æœŸ\nâ†’ æ¥çºŒæ¨™æº–CCRT",
   inclusion:["treatment-naÃ¯ve LACC","é©åˆæ ¹æ²»æ€§CCRT"],
   exclusion:["ç„¡æ³•æ¥å—åŒ–ç™‚æˆ–æ ¹æ²»æ€§æ”¾ç™‚"],
   outcomes:"5yr OS: 80% vs 72% (HR 0.60); 5yr PFS: 73% vs 64% (HR 0.65)"},
  {cancer:"Cervical",pos:["R-TX"],sub:["Recurr / Metastatic"],name:"innovaTV 301 (ENGOT-cx12)",pharma:"Genmab",drug:"Tisotumab Vedotin (ADC)",type:"published",
   pop:"å¾Œç·šADCçªç ´ï¼šOS HR 0.70ï¼›ORR 17.8%ã€‚",
   rationale:"æ¨™é¶çµ„ç¹”å› å­ADCï¼Œè§£æ±ºå¾Œç·šåŒ–ç™‚è€è—¥ã€‚",
   regimen:"Tisotumab Vedotin 2.0mg/kg IV Q3W\nå°ç…§: é†«å¸«é¸æ“‡åŒ–ç™‚",
   inclusion:["recurrent/metastaticå®®é ¸ç™Œ","2L/3Læ²»ç™‚"],
   exclusion:["åš´é‡è§’è†œ/çœ¼éƒ¨é¢¨éšª"],
   outcomes:"mOS: 11.5m vs 9.5m (HR 0.70); ORR 17.8% vs 5.2%"},
  // Uterine Sarcoma
  {cancer:"Uterine Sarcoma",pos:["P-TX","R-TX"],sub:["Carcinosarcoma"],name:"NRG/GOG-0261",pharma:"NRG Oncology",drug:"Paclitaxel + Carboplatin",type:"published",
   pop:"UCSæ–°æ¨™æº–ï¼šPCæ–¹æ¡ˆä¸åŠ£æ–¼PIä¸”æ¯’æ€§é¡¯è‘—é™ä½ã€‚PFS 14.6m vs 10.3mã€‚",
   rationale:"Pacli/Carboç¢ºç«‹ç‚ºç™Œè‚‰ç˜¤ä¸€ç·šæ²»ç™‚æ–°æ¨™ç«¿ï¼Œå–ä»£æ¯’æ€§è¼ƒå¤§çš„Ifosfamideæ–¹æ¡ˆã€‚",
   regimen:"Arm A: Paclitaxel 175mg/mÂ² + Carboplatin AUC6 Q3W\nArm B: Paclitaxel 135mg/mÂ² + Ifosfamide Q3W",
   inclusion:["Stage III-IVæˆ–å¾©ç™¼æ€§å­å®®/åµå·¢ç™Œè‚‰ç˜¤","ECOG 0-2"],
   exclusion:[],
   outcomes:"PFS: 14.6m vs 10.3m; OS: 37m vs 29m (éåŠ£æ•ˆé”æˆ)"},
  {cancer:"Uterine Sarcoma",pos:["R-TX"],sub:["Recurr / Metastatic"],name:"LMS-04",pharma:"French Sarcoma Group",drug:"Doxorubicin + Trabectedin",type:"published",
   pop:"LMSä¸€ç·šæ–°é«˜åº¦ï¼šmPFS 12.2m vs 6.2m (HR 0.37)ã€‚",
   rationale:"å°ˆå°LMSï¼ŒDoxorubicinè¯ç”¨TrabectedinæŒ‘æˆ°å‚³çµ±å–®è—¥æ²»ç™‚ç“¶é ¸ã€‚",
   regimen:"Doxorubicin 60mg/mÂ² + Trabectedin 1.1mg/mÂ² Q3W\nâ†’ æ¥çºŒTrabectedinå–®è—¥ç¶­æŒ",
   inclusion:["æ™šæœŸ/è½‰ç§»æ€§LMS","ä¸€ç·šæ²»ç™‚"],
   exclusion:[],
   outcomes:"mPFS: 12.2m vs 6.2m (HR 0.37); mOS: 31.6m vs 24.1m"},
];

const GUIDELINES = {
  "Endometrial": [
    {id:"P-TX", header:"ğŸŒ¿ åˆæ²» (Primary Tx)", css:"p-tx", subs:[
      {title:"dMMR / MSI-H / MMRd", content:"ä¸€ç·šé¦–é¸ï¼šå«é‰‘åŒ–ç™‚ + PD-1 (RUBY/GY018/AtTEnd)ã€‚"},
      {title:"pMMR / NSMP / MSS", content:"ä¸€ç·šç¶­æŒï¼šChemo + Durva/Ola (DUO-E)ã€‚äºŒç·šæ¨™é¶å…ç–« (KN775)ã€‚"},
      {title:"POLE mutation", content:"é å¾Œæ¥µä½³ã€‚æ—©æœŸè€ƒæ…®æ²»ç™‚é™éš (De-escalation)ã€‚"},
      {title:"p53 mutation", content:"ä¾µè¥²æ€§æœ€å¼·ã€‚å»ºè­°åŒ–æ”¾ç™‚ç©æ¥µä»‹å…¥ã€‚Serouså‹éœ€æª¢æ¸¬HER2ã€‚"}]},
    {id:"P-MT", header:"ğŸ’Š ä¸€ç·šç¶­æŒ (1L Maint)", css:"p-mt", subs:[
      {title:"Maintenance Therapy", content:"ä¸€ç·šIOå¾Œå»¶çºŒç¶­æŒè‡³PD (MK2870-033/DUO-E)ã€‚"}]},
    {id:"R-TX", header:"ğŸ”„ å¾©ç™¼æ²»ç™‚ (Recurr Tx)", css:"r-tx", subs:[
      {title:"Recurrent EC", content:"æ¨™æº–äºŒç·šï¼šæ¨™é¶+å…ç–« (KN775) æˆ–å–®è—¥IO (GARNET)ã€‚æ•‘æ´ADC (SG)ã€‚"}]},
    {id:"R-MT", header:"ğŸ”’ å¾©å¾Œç¶­æŒ (PR-Maint)", css:"r-mt", subs:[
      {title:"Continuous Therapy", content:"æ•‘æ´æ²»ç™‚å¾Œç¶­æŒç•¶å‰æœ‰æ•ˆæ–¹æ¡ˆç›´åˆ°PDã€‚"}]}
  ],
  "Ovarian": [
    {id:"P-TX", header:"ğŸŒ¿ åˆæ²» (Primary Tx)", css:"p-tx", subs:[
      {title:"Neoadjuvant Setting", content:"NAC + IDS + HIPEC (van Driel)ã€‚"},
      {title:"HGSC / Endometrioid", content:"æ‰‹è¡“ (PDS/IDS) + Carbo/Pacli Â± Bevã€‚"},
      {title:"Low grade serous carcinoma", content:"AI, MEK, CDK 4/6ã€‚"},
      {title:"Clear Cell Carcinoma", content:"OCCC ç‰¹æ®Šæ–¹æ¡ˆã€‚"}]},
    {id:"P-MT", header:"ğŸ’Š ä¸€ç·šç¶­æŒ (1L Maint)", css:"p-mt", subs:[
      {title:"BRCA mutation", content:"Olaparibå–®è—¥ç¶­æŒ2å¹´ (SOLO-1)ã€‚"},
      {title:"HRD positive (wt)", content:"PAOLA-1 (Ola+Bev) æˆ– PRIMA (Nira)ã€‚"},
      {title:"HRD negative (pHRD)", content:"Niraparibç¶­æŒ (PRIMA ITT) æˆ–Bevacizumabã€‚"}]},
    {id:"R-TX", header:"ğŸ”„ å¾©ç™¼æ²»ç™‚ (Recurr Tx)", css:"r-tx", subs:[
      {title:"PSOC (Sensitive Recur)", content:"PFI>6mã€‚è©•ä¼°äºŒæ¬¡æ‰‹è¡“ (DESKTOP III) æˆ–å«é‰‘è¤‡æ–¹ã€‚"},
      {title:"PROC (Resistant Recur)", content:"PFI<6mã€‚å–®è—¥åŒ–ç™‚ Â± Bev æˆ–æ¨™é¶ADC (MIRASOL)ã€‚"},
      {title:"Low grade serous carcinoma", content:"AI, MEK, CDK 4/6ã€‚"}]},
    {id:"R-MT", header:"ğŸ”’ å¾©å¾Œç¶­æŒ (PR-Maint)", css:"r-mt", subs:[
      {title:"PARPi Maint", content:"æ•‘æ´ç·©è§£å¾ŒçºŒç”¨PARPi (NOVA/ARIEL3/SOLO2)ã€‚"}]}
  ],
  "Cervical": [
    {id:"P-TX", header:"ğŸŒ¿ åˆæ²» (Primary Tx)", css:"p-tx", subs:[
      {title:"Locally Advanced (CCRT)", content:"åŒæ­¥åŒ–æ”¾ç™‚ Â± åŒæ­¥IO (A18) æˆ–èª˜å°åŒ–ç™‚ (INTERLACE)ã€‚"},
      {title:"Early Stage (Surgery)", content:"æ ¹æ²»è¡“ (LACC) æˆ–å–®ç´”åˆ‡é™¤ (SHAPE)ã€‚"}]},
    {id:"P-MT", header:"ğŸ’Š ä¸€ç·šç¶­æŒ (1L Maint)", css:"p-mt", subs:[
      {title:"Maintenance", content:"1Læ–¹æ¡ˆå¾Œæ¥çºŒç¶­æŒ (KEYNOTE-826)ã€‚"}]},
    {id:"R-TX", header:"ğŸ”„ å¾©ç™¼æ²»ç™‚ (Recurr Tx)", css:"r-tx", subs:[
      {title:"Recurr / Metastatic", content:"ä¸€ç·šKN826/BEATccã€‚äºŒç·šADC (innovaTV 301) æˆ–IO (EMPOWER)ã€‚"}]},
    {id:"R-MT", header:"ğŸ”’ å¾©å¾Œç¶­æŒ (PR-Maint)", css:"r-mt", subs:[
      {title:"Continuous Therapy", content:"ç¶­æŒç•¶å‰æœ‰æ•ˆæ•‘æ´æ–¹æ¡ˆç›´è‡³PDã€‚"}]}
  ],
  "Uterine Sarcoma": [
    {id:"P-TX", header:"ğŸŒ¿ åˆæ²» (Primary Tx)", css:"p-tx", subs:[
      {title:"Primary Sarcoma", content:"è¡“å¾Œè¼”åŠ©æˆ–è½‰ç§»æ€§ä¸å¯åˆ‡é™¤ã€‚"},
      {title:"Carcinosarcoma", content:"PCæ–¹æ¡ˆ (NRG-GOG0261)ã€‚"},
      {title:"Low grade ESS", content:"æ¿€ç´ æ²»ç™‚ (Anastrozole/Letrozole)ã€‚"}]},
    {id:"P-MT", header:"ğŸ’Š ä¸€ç·šç¶­æŒ (1L Maint)", css:"p-mt", subs:[
      {title:"Maintenance", content:"1Læ–¹æ¡ˆå¾Œæ¥çºŒç¶­æŒã€‚"}]},
    {id:"R-TX", header:"ğŸ”„ å¾©ç™¼æ²»ç™‚ (Recurr Tx)", css:"r-tx", subs:[
      {title:"Recurr / Metastatic", content:"LMS: Trabectedin (ET743)ã€Pazopanibã€Eribulinã€‚"},
      {title:"Low grade ESS", content:"æ¿€ç´ æ²»ç™‚ç‚ºä¸»ã€‚"}]},
    {id:"R-MT", header:"ğŸ”’ å¾©å¾Œç¶­æŒ (PR-Maint)", css:"r-mt", subs:[
      {title:"Continuous Therapy", content:"ç¶­æŒç•¶å‰æœ‰æ•ˆæ•‘æ´æ–¹æ¡ˆç›´è‡³PDã€‚"}]}
  ]
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentCancer = 'Endometrial';

function selectCancer(cancer, btn) {
  currentCancer = cancer;
  document.querySelectorAll('.cancer-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderStageGrid(cancer);
}

function renderStageGrid(cancer) {
  const grid = document.getElementById('stage-grid');
  const stages = GUIDELINES[cancer];
  if (!stages) return;
  grid.innerHTML = stages.map(stage => {
    const subsHTML = stage.subs.map(sub => {
      const trials = TRIALS_DB.filter(t =>
        t.cancer === cancer &&
        t.pos.includes(stage.id) &&
        t.sub.some(s => sub.title.includes(s) || s.includes(sub.title.split('(')[0].trim()))
      );
      const trialBtns = trials.map(t => `
        <button class="trial-chip ${t.type === 'ongoing' ? 'ongoing' : ''}"
          onclick="openModal('${encodeURIComponent(JSON.stringify(t))}')">
          ${t.type === 'ongoing' ? 'ğŸ“' : 'ğŸ“š'} ${t.name}
          <br><span style="opacity:0.7">${t.pharma} Â· ${t.drug}</span>
        </button>`).join('');
      return `<div class="sub-section">
        <div class="sub-title">ğŸ“˜ ${sub.title}</div>
        <div class="sub-content">${sub.content}</div>
        ${trialBtns}
      </div>`;
    }).join('');
    return `<div class="stage-col stage-${stage.css}">
      <div class="stage-header">${stage.header}</div>
      ${subsHTML}
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(encoded) {
  const t = JSON.parse(decodeURIComponent(encoded));
  document.getElementById('modalTitle').textContent = t.name;
  document.getElementById('modalDrug').textContent = `${t.pharma} Â· ${t.drug}`;
  document.getElementById('modalResults').textContent = t.pop;
  document.getElementById('modalRationale').textContent = t.rationale;
  document.getElementById('modalRegimen').textContent = t.regimen;
  const incEl = document.getElementById('modalInclusion');
  const excEl = document.getElementById('modalExclusion');
  incEl.innerHTML = (t.inclusion||[]).map(i => `<li>${i}</li>`).join('');
  excEl.innerHTML = (t.exclusion||[]).map(e => `<li>${e}</li>`).join('');
  document.getElementById('detailOverlay').classList.add('open');
}
function closeModal(e, force) {
  if (force || !e || e.target === document.getElementById('detailOverlay')) {
    document.getElementById('detailOverlay').classList.remove('open');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAB SWITCHING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(tab) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  event.target.classList.add('active');
}

function switchMode(mode, btn) {
  ['text','image','form'].forEach(m => {
    document.getElementById('mode-' + m).style.display = m === mode ? 'block' : 'none';
  });
  document.querySelectorAll('.mode-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IMAGE UPLOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let uploadedImageBase64 = null;
let uploadedImageMime = null;

function handleImageUpload(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    const result = e.target.result;
    uploadedImageBase64 = result.split(',')[1];
    uploadedImageMime = file.type;
    document.getElementById('previewImg').src = result;
    document.getElementById('previewName').textContent = `âœ… ${file.name} (${(file.size/1024).toFixed(0)} KB)`;
    document.getElementById('uploadedPreview').classList.add('show');
  };
  reader.readAsDataURL(file);
}

// drag/drop
const uploadZone = document.getElementById('uploadZone');
if (uploadZone) {
  uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.style.borderColor = 'var(--teal)'; });
  uploadZone.addEventListener('dragleave', () => { uploadZone.style.borderColor = ''; });
  uploadZone.addEventListener('drop', e => {
    e.preventDefault(); uploadZone.style.borderColor = '';
    const file = e.dataTransfer.files[0];
    if (file) { document.getElementById('imgUpload').files = e.dataTransfer.files; handleImageUpload({target:{files:[file]}}); }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI ANALYSIS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä½è³‡æ·±å©¦ç§‘è…«ç˜¤è‡¨åºŠé†«å¸«ï¼ŒåŒæ™‚ä¹Ÿæ˜¯è‡¨åºŠè©¦é©—è¨­è¨ˆå°ˆå®¶ã€‚
æ ¹æ“šä»¥ä¸‹å©¦ç™Œè‡¨åºŠè©¦é©—å¯¦è­‰è³‡æ–™åº«ï¼Œé‡å°æ‚£è€…ç—…æ­·è³‡æ–™é€²è¡Œæ·±åº¦åˆ†æï¼Œæä¾›ï¼š

1. ã€åˆ†å­åˆ†å‹è§£è®€ã€‘æ ¹æ“šè¼¸å…¥çš„æ¨™è¨˜ï¼ˆMMRã€p53ã€POLEã€BRCAã€HRDç­‰ï¼‰ï¼Œåˆ¤æ–·æ‚£è€…å±¬æ–¼å“ªå€‹åˆ†å­äºå‹ï¼ŒåŠå…¶é å¾Œæ„ç¾©ã€‚
2. ã€æ¨è–¦æ²»ç™‚è·¯å¾‘ã€‘ä¾æ“šç›®å‰å¯¦è­‰æœ€å¼·çš„æ–¹æ¡ˆï¼Œæä¾›åˆ†æœŸåˆ†ç·šçš„å…·é«”å»ºè­°ï¼ˆè«‹å¼•ç”¨è©¦é©—åç¨±å¦‚RUBYã€KN775ç­‰ï¼‰ã€‚
3. ã€å¯åƒèˆ‡è‡¨åºŠè©¦é©—ã€‘åˆ—å‡ºç¬¦åˆæ¢ä»¶çš„é€²è¡Œä¸­è©¦é©—ï¼ˆæ¨™è¨˜ğŸ“è€…ï¼‰ï¼Œèªªæ˜ç¬¦åˆåŸå› ã€‚
4. ã€é¢¨éšªèˆ‡æ³¨æ„äº‹é …ã€‘å…ç–«ç›¸é—œå‰¯ä½œç”¨ã€PARPiè¡€æ¶²æ¯’æ€§ã€ADCçœ¼æ¯’æ€§ç­‰å€‹åˆ¥åŒ–æ³¨æ„äº‹é …ã€‚

è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡ï¼Œå›ç­”è¦ç²¾æº–ä¸”æœ‰æ¢ç†ï¼Œç”¨é†«å¸«å°é†«å¸«çš„èªæ°£ï¼Œä¸éœ€éåº¦è§£é‡‹åŸºç¤çŸ¥è­˜ã€‚`;

async function runAnalysis() {
  const apiKey = document.getElementById('apiKey').value.trim();
  if (!apiKey) { alert('è«‹å…ˆè¼¸å…¥ Gemini API Keyã€‚'); return; }

  let userContent = '';
  const activeMode = document.querySelector('.mode-tab.active').textContent.trim();

  if (activeMode.includes('æ–‡å­—')) {
    userContent = document.getElementById('textInput').value.trim();
    if (!userContent) { alert('è«‹è¼¸å…¥æ‚£è€…ç—…æ­·æ‘˜è¦ã€‚'); return; }
  } else if (activeMode.includes('å½±åƒ')) {
    if (!uploadedImageBase64) { alert('è«‹å…ˆä¸Šå‚³å½±åƒæª”æ¡ˆã€‚'); return; }
    userContent = document.getElementById('imageContextInput').value || 'è«‹åˆ†ææ­¤ç—…ç†/å½±åƒåœ–ç‰‡ï¼Œä¸¦æ ¹æ“šå©¦ç™Œè©¦é©—è³‡æ–™åº«çµ¦å‡ºæ²»ç™‚å»ºè­°ã€‚';
  } else {
    const cancer = document.getElementById('f-cancer').value;
    const stage = document.getElementById('f-stage').value;
    const mmr = document.getElementById('f-mmr').value;
    const p53 = document.getElementById('f-p53').value;
    const brca = document.getElementById('f-brca').value;
    const ecog = document.getElementById('f-ecog').value;
    const prior = document.getElementById('f-prior').value;
    const markers = document.getElementById('f-markers').value;
    userContent = `ç™Œç—‡: ${cancer} | åˆ†æœŸ: ${stage} | MMR: ${mmr} | p53: ${p53} | BRCA/HRD: ${brca} | ECOG: ${ecog} | æ—¢å¾€æ²»ç™‚: ${prior} | å…¶ä»–æ¨™è¨˜: ${markers}`;
  }

  // Build request
  const btn = document.getElementById('analyzeBtn');
  btn.disabled = true;
  document.getElementById('btnIcon').innerHTML = '<div class="spinner"></div>';
  document.getElementById('btnText').textContent = 'Gemini AI åˆ†æä¸­â€¦';

  const trialSummary = TRIALS_DB.map(t => `[${t.name}] ${t.cancer} ${t.pos.join('/')} - ${t.pop}`).join('\n');
  const fullPrompt = `${SYSTEM_PROMPT}\n\n===è©¦é©—è³‡æ–™åº«æ‘˜è¦===\n${trialSummary}\n\n===æ‚£è€…è³‡æ–™===\n${userContent}`;

  let requestBody;
  if (uploadedImageBase64 && activeMode.includes('å½±åƒ')) {
    requestBody = { contents: [{ parts: [
      { text: fullPrompt },
      { inline_data: { mime_type: uploadedImageMime, data: uploadedImageBase64 } }
    ]}]};
  } else {
    requestBody = { contents: [{ parts: [{ text: fullPrompt }] }] };
  }

  try {
    const res = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,
      { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(requestBody) }
    );
    if (!res.ok) {
      const err = await res.json();
      throw new Error(err.error?.message || `HTTP ${res.status}`);
    }
    const data = await res.json();
    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || 'ç„¡æ³•å–å¾—å›æ‡‰ã€‚';
    displayResult(text);
  } catch (err) {
    alert(`âŒ åˆ†æå¤±æ•—ï¼š${err.message}\n\nè«‹ç¢ºèª API Key æ˜¯å¦æ­£ç¢ºï¼Œæˆ–æ‚¨çš„ç¶²è·¯æ˜¯å¦å…è¨±é€£æ¥ Google APIã€‚`);
  } finally {
    btn.disabled = false;
    document.getElementById('btnIcon').textContent = 'âœ¨';
    document.getElementById('btnText').textContent = 'å•Ÿå‹• Gemini AI åˆ†æ';
  }
}

function displayResult(text) {
  const resultDiv = document.getElementById('aiResult');
  const contentDiv = document.getElementById('resultContent');
  // Convert markdown-like to HTML
  let html = text
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/^#{1,3}\s(.+)$/gm, '<h4>$1</h4>')
    .replace(/^[-â€¢]\s(.+)$/gm, '<li>$1</li>')
    .replace(/(<li>.*<\/li>\n?)+/g, match => `<ul>${match}</ul>`)
    .replace(/\n\n/g, '</p><p>')
    .replace(/\n/g, '<br>');
  contentDiv.innerHTML = `<p>${html}</p>`;
  resultDiv.classList.add('show');
  resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderStageGrid('Endometrial');
</script>
</body>
</html>
